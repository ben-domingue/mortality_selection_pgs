load("~/hrs/mortality/all.Rdata")
df[df$rabyear %in% 1910:1959,]->df
   
library(survival)
library(survey)
#svycoxph(Surv(time=age,event=dead)~geno+ragender,design = svydesign(~ 1, weights = ~ 1,data=df))->mod
coxph(Surv(time=age,event=dead)~rabyear*geno*ragender,df)->mod
#
par(mfrow=c(2,3))
plot(NULL,xlab="Age",ylab="",xlim=c(50,max(df$age,na.rm=TRUE)),ylim=c(0,1),main="Males-1920")
data.frame(geno=1,ragender="1.male",rabyear=1920)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv)
data.frame(geno=0,ragender="1.male",rabyear=1920)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv,lty=2)
#
plot(NULL,xlab="Age",ylab="",xlim=c(50,max(df$age,na.rm=TRUE)),ylim=c(0,1),main="Males-1935")
data.frame(geno=1,ragender="1.male",rabyear=1935)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv)
data.frame(geno=0,ragender="1.male",rabyear=1935)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv,lty=2)
#
plot(NULL,xlab="Age",ylab="",xlim=c(50,max(df$age,na.rm=TRUE)),ylim=c(0,1),main="Males-1950")
data.frame(geno=1,ragender="1.male",rabyear=1950)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv)
data.frame(geno=0,ragender="1.male",rabyear=1950)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv,lty=2)
#
plot(NULL,xlab="Age",ylab="",xlim=c(50,max(df$age,na.rm=TRUE)),ylim=c(0,1),main="Female-1920")
data.frame(geno=1,ragender="2.female",rabyear=1920)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv)
data.frame(geno=0,ragender="2.female",rabyear=1920)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv,lty=2)
#
plot(NULL,xlab="Age",ylab="",xlim=c(50,max(df$age,na.rm=TRUE)),ylim=c(0,1),main="Females-1935")
data.frame(geno=1,ragender="2.female",rabyear=1935)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv)
data.frame(geno=0,ragender="2.female",rabyear=1935)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv,lty=2)
#
plot(NULL,xlab="Age",ylab="",xlim=c(50,max(df$age,na.rm=TRUE)),ylim=c(0,1),main="Females-1950")
data.frame(geno=1,ragender="2.female",rabyear=1950)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv)
data.frame(geno=0,ragender="2.female",rabyear=1950)->z
survfit(mod,newdata=z)->mod2
lines(mod2$time,mod2$surv,lty=2)
